apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'idea'
apply plugin: 'maven'
apply plugin: 'groovy'
apply plugin: 'io.qameta.allure'
apply plugin: 'docker-compose'

group 'webui'
version '1.0-SNAPSHOT'

sourceCompatibility = 1.8

repositories {
    maven { url "https://repo.maven.apache.org/maven2" }
    maven { url "https://plugins.gradle.org/m2/" }
    mavenCentral()
    jcenter()
}

buildscript {
    repositories {
        maven { url "https://repo.maven.apache.org/maven2" }
        maven { url "https://plugins.gradle.org/m2/" }
        mavenCentral()
    }
    dependencies {
        classpath "io.qameta.allure:allure-gradle:+"
        classpath "com.avast.gradle:gradle-docker-compose-plugin:+"
    }
}

allure {
    autoconfigure = true
    aspectjweaver = true
    version = '2.13.1'
    useTestNG {
        version = '2.13.1'
    }
    downloadLink = 'https://dl.bintray.com/qameta/maven/io/qameta/allure/allure-commandline/2.13.1/allure-commandline-2.13.1.zip'
}

sourceSets {
    main {
        java {
            srcDir 'src/main/java'
        }
    }
    test {
        java.srcDir file('src/test/java')
        resources.srcDir file('scr/test/resource')
        compileClasspath = sourceSets.main.output + configurations.testRuntime
        runtimeClasspath = output + compileClasspath
    }
}

// dockerCompose.isRequiredBy(test)

dockerCompose {
    useComposeFiles = ['docker-compose.yml']
    startedServices = ['chrome', 'firefox']
    scale = [chrome: 2, firefox: 2]
    stopContainers = true
    removeContainers = true
}

dependencies {
    compile group: 'io.netty', name: 'netty-all', version: '4.1.44.Final'
    compile group: 'org.seleniumhq.selenium', name: 'selenium-java', version: '4.0.0-alpha-5'
    compile group: 'org.seleniumhq.selenium', name: 'selenium-server', version: '4.0.0-alpha-2'
    compile group: 'org.seleniumhq.selenium', name: 'selenium-chrome-driver', version: '4.0.0-alpha-5'
    compile group: 'org.seleniumhq.selenium', name: 'selenium-firefox-driver', version: '4.0.0-alpha-5'
    compile group: 'org.seleniumhq.selenium', name: 'selenium-remote-driver', version: '4.0.0-alpha-5'
    compile group: 'org.seleniumhq.selenium', name: 'selenium-ie-driver', version: '4.0.0-alpha-5'
    compile group: 'org.seleniumhq.selenium', name: 'selenium-edge-driver', version: '4.0.0-alpha-5'
    compile group: 'com.amazonaws', name: 'aws-java-sdk-s3', version: '1.11.711'
    compile group: 'com.amazonaws', name: 'aws-java-sdk-devicefarm', version: '1.11.779'
    compile group: 'net.reini', name: 'slf4-cdi', version: '1.0'
    compile group: 'org.assertj', name: 'assertj-core', version: '3.13.2'
    compile group: 'org.hamcrest', name: 'hamcrest-all', version: '1.3'
    compile group: 'org.testng', name: 'testng', version: '7.0.0'
    compile group: 'com.googlecode.json-simple', name: 'json-simple', version: '1.1.1'
    compile group: 'commons-io', name: 'commons-io', version: '2.6'
    compile group: 'com.aventstack', name: 'extentreports', version: '4.1.5'
    compile group: 'net.sourceforge.javacsv', name: 'javacsv', version: '2.0'
    compile group: 'org.apache.poi', name: 'poi-ooxml', version: '4.1.2'
    compile group: 'org.apache.poi', name: 'poi-ooxml-schemas', version: '4.1.2'
    compile group: 'org.apache.poi', name: 'poi-excelant', version: '4.1.2'
    compile group: 'org.apache.poi', name: 'poi-examples', version: '4.1.2'
    compile group: 'org.apache.poi', name: 'poi-scratchpad', version: '4.1.2'
    compile group: 'org.apache.poi', name: 'poi', version: '4.1.2'
    compile group: 'org.apache.xmlbeans', name: 'xmlbeans', version: '3.1.0'
    compile group: 'com.microsoft.sqlserver', name: 'mssql-jdbc', version: '8.2.2.jre8'
    compile group: 'org.slf4j', name: 'slf4j-log4j12', version: '1.7.28'
    compile group: 'com.github.javafaker', name: 'javafaker', version: '1.0.2'
    compile group: 'io.rest-assured', name: 'rest-assured', version: '4.3.0'
    compile group: 'org.json', name: 'json', version: '20190722'
    compile group: 'com.konghq', name: 'unirest-java', version: '3.7.02'
    compile group: 'org.apache.logging.log4j', name: 'log4j-core', version: '2.13.2'
    compile group: 'org.apache.logging.log4j', name: 'log4j-api', version: '2.13.2'
    compile group: 'com.github.tomakehurst', name: 'wiremock', version: '2.26.3'
    compile group: 'net.lightbody.bmp', name: 'browsermob-core', version: '2.1.5'
    compile group: 'org.zaproxy', name: 'zap-clientapi', version: '1.8.0'
    compile group: 'org.zaproxy', name: 'zap', version: '2.9.0'
    compile group: 'net.lingala.zip4j', name: 'zip4j', version: '2.5.2'
    compile group: 'io.qameta.allure', name: 'allure-gradle', version: '2.8.1'
    compile group: 'io.qameta.allure', name: 'allure-testng', version: '2.13.1'
    compile group: 'org.awaitility', name: 'awaitility', version: '4.0.2'
}

task E2E(type: Test) {
    useTestNG() {
        outputDirectory = file("$project.buildDir/testngOutput")
        useDefaultListeners = true
        suiteXmlFiles << new File("src/test/java/suite/testng.xml")
        setSuiteXmlFiles(suiteXmlFiles)
    }
    testLogging {
        exceptionFormat "full"
        events "started", "passed", "skipped", "failed", "standardOut", "standardError"
        minGranularity 0
    }
    reports {
        junitXml.enabled = false
        html.enabled = true
    }
}
